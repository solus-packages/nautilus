From bf69e1ecd6848f73d3c0e65c8f643f8063d027c2 Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Thu, 2 Mar 2017 18:49:23 +0000
Subject: [PATCH 2/2] Only use Tracker when it's actually enabled.

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 src/nautilus-file-undo-operations.c | 6 +++++-
 src/nautilus-file.c                 | 4 ++++
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/src/nautilus-file-undo-operations.c b/src/nautilus-file-undo-operations.c
index 093251d..23d5809 100644
--- a/src/nautilus-file-undo-operations.c
+++ b/src/nautilus-file-undo-operations.c
@@ -31,9 +31,10 @@
 #include "nautilus-file-operations.h"
 #include "nautilus-file.h"
 #include "nautilus-file-undo-manager.h"
+#ifdef ENABLE_TRACKER
 #include "nautilus-batch-rename-dialog.h"
 #include "nautilus-batch-rename-utilities.h"
-
+#endif
 
 /* Since we use g_get_current_time for setting "orig_trash_time" in the undo
  * info, there are situations where the difference between this value and the
@@ -1086,6 +1087,7 @@ nautilus_file_undo_info_rename_set_data_post (NautilusFileUndoInfoRename *self,
     self->priv->new_file = g_object_ref (new_file);
 }
 
+#ifdef ENABLE_TRACKER
 /* batch rename */
 G_DEFINE_TYPE (NautilusFileUndoInfoBatchRename, nautilus_file_undo_info_batch_rename, NAUTILUS_TYPE_FILE_UNDO_INFO);
 
@@ -1304,6 +1306,8 @@ nautilus_file_undo_info_batch_rename_set_data_post (NautilusFileUndoInfoBatchRen
     self->priv->new_display_names = g_list_reverse (self->priv->new_display_names);
 }
 
+#endif /* ENABLE_TRACKER */
+
 /* trash */
 G_DEFINE_TYPE (NautilusFileUndoInfoTrash, nautilus_file_undo_info_trash, NAUTILUS_TYPE_FILE_UNDO_INFO)
 
diff --git a/src/nautilus-file.c b/src/nautilus-file.c
index 106ebbc..cebd914 100644
--- a/src/nautilus-file.c
+++ b/src/nautilus-file.c
@@ -2272,6 +2272,7 @@ nautilus_file_can_rename_file (NautilusFile                  *file,
     return new_file_name;
 }
 
+#if ENABLE_TRACKER
 static void
 real_batch_rename (GList                         *files,
                    GList                         *new_names,
@@ -2380,6 +2381,7 @@ real_batch_rename (GList                         *files,
         nautilus_file_operation_complete (op, NULL, error);
     }
 }
+#endif
 
 gboolean
 nautilus_file_rename_handle_file_gone (NautilusFile                  *file,
@@ -2407,6 +2409,7 @@ nautilus_file_rename_handle_file_gone (NautilusFile                  *file,
     return FALSE;
 }
 
+#if ENABLE_TRACKER
 void
 nautilus_file_batch_rename (GList                         *files,
                             GList                         *new_names,
@@ -2418,6 +2421,7 @@ nautilus_file_batch_rename (GList                         *files,
                        callback,
                        callback_data);
 }
+#endif
 
 static void
 real_rename (NautilusFile                  *file,
-- 
2.12.0

